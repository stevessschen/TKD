root@m8cpqd23301-1760604606377-54ffc55677-fpr2z:/home/data# mkdir test4
root@m8cpqd23301-1760604606377-54ffc55677-fpr2z:/home/data# cd test4
root@m8cpqd23301-1760604606377-54ffc55677-fpr2z:/home/data/test4# git clone https://github.com/stevessschen/TKD.git
Cloning into 'TKD'...
remote: Enumerating objects: 74, done.
remote: Counting objects: 100% (74/74), done.
remote: Compressing objects: 100% (65/65), done.
remote: Total 74 (delta 24), reused 0 (delta 0), pack-reused 0 (from 0)
Receiving objects: 100% (74/74), 41.48 KiB | 1.12 MiB/s, done.
Resolving deltas: 100% (24/24), done.
root@m8cpqd23301-1760604606377-54ffc55677-fpr2z:/home/data/test4# cd TKD
root@m8cpqd23301-1760604606377-54ffc55677-fpr2z:/home/data/test4/TKD# pip install -r requirements.txt
Requirement already satisfied: numba==0.62.1 in /usr/local/lib/python3.10/dist-packages (from -r requirements.txt (line 1)) (0.62.1)
Requirement already satisfied: numpy==1.26.4 in /usr/local/lib/python3.10/dist-packages (from -r requirements.txt (line 2)) (1.26.4)
Requirement already satisfied: pandas==2.2.1 in /usr/local/lib/python3.10/dist-packages (from -r requirements.txt (line 3)) (2.2.1)
Requirement already satisfied: scikit-learn==1.7.2 in /usr/local/lib/python3.10/dist-packages (from -r requirements.txt (line 4)) (1.7.2)
Requirement already satisfied: scipy==1.15.3 in /usr/local/lib/python3.10/dist-packages (from -r requirements.txt (line 5)) (1.15.3)
Requirement already satisfied: torch==2.1.0+cpu in /usr/local/lib/python3.10/dist-packages (from -r requirements.txt (line 6)) (2.1.0+cpu)
Requirement already satisfied: tqdm==4.67.1 in /usr/local/lib/python3.10/dist-packages (from -r requirements.txt (line 7)) (4.67.1)
Requirement already satisfied: llvmlite<0.46,>=0.45.0dev0 in /usr/local/lib/python3.10/dist-packages (from numba==0.62.1->-r requirements.txt (line 1)) (0.45.1)
Requirement already satisfied: python-dateutil>=2.8.2 in /usr/local/lib/python3.10/dist-packages (from pandas==2.2.1->-r requirements.txt (line 3)) (2.9.0.post0)
Requirement already satisfied: pytz>=2020.1 in /usr/local/lib/python3.10/dist-packages (from pandas==2.2.1->-r requirements.txt (line 3)) (2025.2)
Requirement already satisfied: tzdata>=2022.7 in /usr/local/lib/python3.10/dist-packages (from pandas==2.2.1->-r requirements.txt (line 3)) (2025.2)
Requirement already satisfied: joblib>=1.2.0 in /usr/local/lib/python3.10/dist-packages (from scikit-learn==1.7.2->-r requirements.txt (line 4)) (1.5.2)
Requirement already satisfied: threadpoolctl>=3.1.0 in /usr/local/lib/python3.10/dist-packages (from scikit-learn==1.7.2->-r requirements.txt (line 4)) (3.6.0)
Requirement already satisfied: filelock in /usr/local/lib/python3.10/dist-packages (from torch==2.1.0+cpu->-r requirements.txt (line 6)) (3.20.0)
Requirement already satisfied: typing-extensions in /usr/local/lib/python3.10/dist-packages (from torch==2.1.0+cpu->-r requirements.txt (line 6)) (4.11.0)
Requirement already satisfied: sympy in /usr/local/lib/python3.10/dist-packages (from torch==2.1.0+cpu->-r requirements.txt (line 6)) (1.14.0)
Requirement already satisfied: networkx in /usr/local/lib/python3.10/dist-packages (from torch==2.1.0+cpu->-r requirements.txt (line 6)) (3.4.2)
Requirement already satisfied: jinja2 in /usr/local/lib/python3.10/dist-packages (from torch==2.1.0+cpu->-r requirements.txt (line 6)) (3.1.6)
Requirement already satisfied: fsspec in /usr/local/lib/python3.10/dist-packages (from torch==2.1.0+cpu->-r requirements.txt (line 6)) (2025.10.0)
Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.10/dist-packages (from python-dateutil>=2.8.2->pandas==2.2.1->-r requirements.txt (line 3)) (1.16.0)
Requirement already satisfied: MarkupSafe>=2.0 in /usr/local/lib/python3.10/dist-packages (from jinja2->torch==2.1.0+cpu->-r requirements.txt (line 6)) (2.1.5)
Requirement already satisfied: mpmath<1.4,>=1.1.0 in /usr/local/lib/python3.10/dist-packages (from sympy->torch==2.1.0+cpu->-r requirements.txt (line 6)) (1.3.0)
WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager, possibly rendering your system unusable. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv. Use the --root-user-action option if you know what you are doing and want to suppress this warning.
root@m8cpqd23301-1760604606377-54ffc55677-fpr2z:/home/data/test4/TKD# python3 main.py
âœ“ å¥—ä»¶è¼‰å…¥å®Œæˆ
PyTorchç‰ˆæœ¬: 2.1.0+cpu
CUDAå¯ç”¨: False
======================================================================
  ğŸ¯ ç¬¬1æ¬¡æ–¹æ¡ˆï¼šæ™‚åºçª—å£å¢å¼·ç‰ˆ
======================================================================
åŸºæ–¼ï¼šF1-0.277.py æˆåŠŸé…ç½®
æ–°å¢ï¼š6ç¶­æ™‚åºçª—å£ç‰¹å¾µ
ç¸½ç‰¹å¾µï¼š21 + 6 = 27ç¶­

æ™‚åºçª—å£è¨­è¨ˆï¼š
  - æ—©æœŸï¼šday 1-60
  - ä¸­æœŸï¼šday 61-90
  - æ™šæœŸï¼šday 91-121 â­ é—œéµçª—å£

ç›®æ¨™ï¼šF1 0.30-0.35
======================================================================

======================================================================
  éšæ®µ 1: æ•¸æ“šè¼‰å…¥
======================================================================

è¼‰å…¥äº¤æ˜“æ•¸æ“š: /home/data/dataset/acct_transaction.csv
  âœ“ è¼‰å…¥ 4,435,890 ç­†äº¤æ˜“
  âœ“ äº¤æ˜“æ—¥æœŸç¯„åœ: day 1 - day 121

å»ºç«‹å¸³æˆ¶æ˜ å°„...
  âœ“ ç™¼ç¾ 1,800,106 å€‹å”¯ä¸€å¸³æˆ¶

======================================================================
  éšæ®µ 2: ç‰¹å¾µå·¥ç¨‹
======================================================================

======================================================================
  ç‰¹å¾µå·¥ç¨‹ï¼ˆ27ç¶­ï¼‰
======================================================================

[ç‰¹å¾µ1/5] æå–åŸºç¤ç‰¹å¾µ (10ç¶­)...
  âœ“ åŸºç¤ç‰¹å¾µå½¢ç‹€: (1800106, 10)
[ç‰¹å¾µ2/5] æå–æ™‚é–“ç‰¹å¾µ (5ç¶­)...
  âœ“ æ™‚é–“ç‰¹å¾µå½¢ç‹€: (1800106, 5)
[ç‰¹å¾µ3/5] æå–äº¤æ˜“æ¨¡å¼ç‰¹å¾µ (5ç¶­)...
  âœ“ æ¨¡å¼ç‰¹å¾µå½¢ç‹€: (1800106, 5)
[ç‰¹å¾µ4/5] âš¡ æå–æ™‚åºçª—å£ç‰¹å¾µ (6ç¶­) - è¶…å¿«é€Ÿç‰ˆ...
  [1/3] è³‡æ–™é è™•ç†...
  [2/3] Numba åŠ é€Ÿè¨ˆç®—ä¸­...
  [3/3] è¨ˆç®—æ´¾ç”Ÿç‰¹å¾µ...
  âœ“ æ™‚åºçª—å£ç‰¹å¾µå½¢ç‹€: (1800106, 6)
  âš¡ åŸ·è¡Œæ™‚é–“: 2.9 ç§’ (åŠ é€Ÿç‰ˆ)
[ç‰¹å¾µ5/5] æ§‹å»ºåœ–çµæ§‹...
  âœ“ åœ–é‚Šæ•¸: 4,274,300
  è¨ˆç®—PageRank...
    æ”¶æ–‚æ–¼ç¬¬ 81 æ¬¡è¿­ä»£
  âœ“ PageRankç‰¹å¾µå½¢ç‹€: (1800106, 1)

åˆä½µå¾Œç‰¹å¾µå½¢ç‹€: (1800106, 27)
  - åŸºç¤ç‰¹å¾µ: 10ç¶­
  - æ™‚é–“ç‰¹å¾µ: 5ç¶­
  - æ¨¡å¼ç‰¹å¾µ: 5ç¶­
  - â­ æ™‚åºçª—å£: 6ç¶­ (æ–°å¢)
  - PageRank: 1ç¶­
  - ç¸½è¨ˆ: 27ç¶­

æ¨™æº–åŒ–ç‰¹å¾µ...
  âœ“ ç‰¹å¾µå·²å‰ªè£è‡³ [-3, 3] æ¨™æº–å·®ç¯„åœ
æ­£è¦åŒ–é„°æ¥çŸ©é™£...

âœ“ ç‰¹å¾µå·¥ç¨‹å®Œæˆ

æœ€çµ‚æ•¸æ“šæ‘˜è¦:
  - ç¯€é»æ•¸: 1,800,106
  - é‚Šæ•¸: 4,274,300
  - ç‰¹å¾µç¶­åº¦: (1800106, 27)

======================================================================
  éšæ®µ 3: å»ºç«‹æ¨™ç±¤
======================================================================

======================================================================
  å»ºç«‹è¨“ç·´æ¨™ç±¤ (Hard Negative Mining)
======================================================================
æ­£æ¨£æœ¬æ•¸: 1,004
è² æ¨£æœ¬æ•¸: 5,020 (å›°é›£: 2,510, éš¨æ©Ÿ: 2,510)

è¨“ç·´é›†: 4,820 (æ­£æ¨£æœ¬: 814)
é©—è­‰é›†: 1,204 (æ­£æ¨£æœ¬: 190)

======================================================================
  éšæ®µ 4: æ¨¡å‹è¨“ç·´
======================================================================

======================================================================
  è¨“ç·´æ¨¡å‹ (seed=42)
======================================================================

é–‹å§‹è¨“ç·´...
Training:  32%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹              | 48/150 [07:08<14:24,  8.48s/it, loss=1.515, vTraining:  33%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š              | 49/150 [07:16<14:06,  8.38s/it, loss=1.515, vTraining:  33%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š              | 49/150 [07:27<14:06,  8.38s/it, loss=1.483, vTraining:  33%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ              | 50/150 [07:27<14:59,  8.99s/it, loss=1.483, vTraining:  34%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–             | 51/150 [07:35<14:17,  8.67s/it, loss=1.483, vTraining:  35%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–             | 52/150 [07:43<14:03,  8.61s/it, loss=1.483, vTraining:  35%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–             | 53/150 [07:51<13:36,  8.42s/it, loss=1.483, vTraining:  36%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ             | 54/150 [08:03<15:08,  9.47s/it, loss=1.483, vTraining:  36%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ             | 54/150 [08:14<15:08,  9.47s/it, loss=1.486, vTraining:  37%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹             | 55/150 [08:14<15:35,  9.85s/it, loss=1.486, vTraining:  37%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š             | 56/150 [08:22<14:31,  9.27s/it, loss=1.486, vTraining:  38%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰             | 57/150 [08:30<13:48,  8.91s/it, loss=1.486, vTraining:  86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 129/150 [19:17<02:55,  8.35s/it, loss=1.339, val_F1=0.885, val_P=0.920, val_R=0.853]
  âœ“ Early stopping at epoch 130
Training:  86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 129/150 [19:17<03:08,  8.97s/it, loss=1.339, val_F1=0.885, val_P=0.920, val_R=0.853]

  å°‹æ‰¾æœ€ä½³é–¾å€¼...
  âœ“ æœ€ä½³é©—è­‰F1=0.8964 @ epoch 100
  âœ“ æœ€ä½³é–¾å€¼=0.45, ä½¿ç”¨è©²é–¾å€¼çš„F1=0.8918

âœ“ è¨“ç·´å®Œæˆï¼

======================================================================
  éšæ®µ 5: é©—è­‰é›†è©•ä¼°
======================================================================

æœ€çµ‚é©—è­‰é›†çµæœ (é–¾å€¼=0.45):
  Precision: 0.8737
  Recall: 0.9105
  F1 Score: 0.8918

======================================================================
  éšæ®µ 6: é æ¸¬
======================================================================
  âœ“ è¼‰å…¥ 4,780 å€‹å¾…é æ¸¬å¸³æˆ¶

âœ“ é æ¸¬çµæœå·²å„²å­˜è‡³: ./output/predictions_plan1_temporal.csv

é æ¸¬çµ±è¨ˆ:
  é æ¸¬ç‚ºç•°å¸¸: 572 (11.97%)

======================================================================
  ğŸ¯ ç¬¬1æ¬¡æ–¹æ¡ˆåŸ·è¡Œå®Œæˆï¼
======================================================================
é©—è­‰é›†F1: 0.8918
æœ€ä½³é–¾å€¼: 0.45
è¼¸å‡ºæª”æ¡ˆ: ./output/predictions_plan1_temporal.csv

â­ æ–°å¢æ™‚åºç‰¹å¾µï¼š
  1. æ—©æœŸäº¤æ˜“é »ç‡
  2. æ™šæœŸäº¤æ˜“é »ç‡
  3. é »ç‡è®ŠåŒ–ç‡ (æŠ“ä½çªç„¶æ´»èº)
  4. æ™šæœŸå¹³å‡é‡‘é¡
  5. é‡‘é¡è®ŠåŒ–ç‡ (æŠ“ä½çªç„¶å¤§é¡)
  6. æœ€å¾Œäº¤æ˜“æ—¥ (è¶Šæ¥è¿‘day 121è¶Šå¯ç–‘)
======================================================================
root@m8cpqd23301-1760604606377-54ffc55677-fpr2z:/home/data/test4/TKD# ^C
root@m8cpqd23301-1760604606377-54ffc55677-fpr2z:/home/data/test4/TKD# 
